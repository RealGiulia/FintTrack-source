<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meus Gastos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="expenses-container">
        <!-- Header -->
        <div class="expenses-header">
            <h1>ğŸ’° Controle de Gastos</h1>
            <a href="{{ url_for('dashboard') }}" class="btn-back">â† Voltar</a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Resumo -->
        <div class="summary-cards">
            <div class="summary-card total">
                <h3>Total de Gastos</h3>
                <p class="amount">R$ {{ "%.2f"|format(total) }}</p>
            </div>
            
            <div class="summary-card count">
                <h3>Quantidade</h3>
                <p class="amount">{{ expenses|length }}</p>
                <p class="label">gastos registrados</p>
            </div>
        </div>

        <!-- Gastos por Categoria -->
        {% if categories %}
        <div class="categories-section">
            <h2>Gastos por Categoria</h2>
            <div class="category-grid">
                {% for category, amount in categories.items() %}
                <div class="category-card">
                    <span class="category-name">{{ category }}</span>
                    <span class="category-amount">R$ {{ "%.2f"|format(amount) }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- FormulÃ¡rio de Adicionar Gasto -->
        <div class="add-expense-form">
            <h2>Adicionar Novo Gasto</h2>
            <form method="POST" action="{{ url_for('add_expense') }}">
                <div class="form-row">
                    <div class="input-group">
                        <label for="description">DescriÃ§Ã£o</label>
                        <input type="text" id="description" name="description" placeholder="Ex: AlmoÃ§o no restaurante" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="amount">Valor (R$)</label>
                        <input type="number" id="amount" name="amount" step="0.01" min="0.01" placeholder="0.00" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <label for="category">Categoria</label>
                        <select id="category" name="category" required>
                            <option value="">Selecione...</option>
                            <option value="AlimentaÃ§Ã£o">ğŸ” AlimentaÃ§Ã£o</option>
                            <option value="Transporte">ğŸš— Transporte</option>
                            <option value="Moradia">ğŸ  Moradia</option>
                            <option value="SaÃºde">ğŸ’Š SaÃºde</option>
                            <option value="EducaÃ§Ã£o">ğŸ“š EducaÃ§Ã£o</option>
                            <option value="Lazer">ğŸ® Lazer</option>
                            <option value="Compras">ğŸ›’ Compras</option>
                            <option value="Contas">ğŸ“„ Contas</option>
                            <option value="Outros">ğŸ“¦ Outros</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="date">Data</label>
                        <input type="date" id="date" name="date" value="{{ today }}" required>
                    </div>
                </div>
                
                <button type="submit" class="btn-add">+ Adicionar Gasto</button>
            </form>
        </div>

        <!-- Lista de Gastos -->
        <div class="expenses-list">
            <h2>HistÃ³rico de Gastos</h2>
            
            {% if expenses %}
                <div class="expenses-table">
                    {% for expense in expenses %}
                    <div class="expense-item">
                        <div class="expense-info">
                            <div class="expense-main">
                                <span class="expense-description">{{ expense.description }}</span>
                                <span class="expense-category">{{ expense.category }}</span>
                            </div>
                            <div class="expense-date">{{ expense.date.strftime('%d/%m/%Y') }}</div>
                        </div>
                        
                        <div class="expense-actions">
                            <span class="expense-amount">R$ {{ "%.2f"|format(expense.amount) }}</span>
                            <button class="btn-edit" onclick="editExpense({{ expense.id }}, '{{ expense.description }}', {{ expense.amount }}, '{{ expense.category }}', '{{ expense.date }}')">âœï¸</button>
                            <a href="{{ url_for('delete_expense', id=expense.id) }}" class="btn-delete" onclick="return confirm('Tem certeza que deseja deletar este gasto?')">ğŸ—‘ï¸</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>ğŸ“ Nenhum gasto registrado ainda.</p>
                    <p>Comece adicionando seu primeiro gasto acima!</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Modal de EdiÃ§Ã£o -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Editar Gasto</h2>
            <form id="editForm" method="POST">
                <div class="input-group">
                    <label for="edit_description">DescriÃ§Ã£o</label>
                    <input type="text" id="edit_description" name="description" required>
                </div>
                
                <div class="input-group">
                    <label for="edit_amount">Valor (R$)</label>
                    <input type="number" id="edit_amount" name="amount" step="0.01" required>
                </div>
                
                <div class="input-group">
                    <label for="edit_category">Categoria</label>
                    <select id="edit_category" name="category" required>
                        <option value="AlimentaÃ§Ã£o">ğŸ” AlimentaÃ§Ã£o</option>
                        <option value="Transporte">ğŸš— Transporte</option>
                        <option value="Moradia">ğŸ  Moradia</option>
                        <option value="SaÃºde">ğŸ’Š SaÃºde</option>
                        <option value="EducaÃ§Ã£o">ğŸ“š EducaÃ§Ã£o</option>
                        <option value="Lazer">ğŸ® Lazer</option>
                        <option value="Compras">ğŸ›’ Compras</option>
                        <option value="Contas">ğŸ“„ Contas</option>
                        <option value="Outros">ğŸ“¦ Outros</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="edit_date">Data</label>
                    <input type="date" id="edit_date" name="date" required>
                </div>
                
                <button type="submit" class="btn-add">Salvar AlteraÃ§Ãµes</button>
            </form>
        </div>
    </div>

    <script>
        // Definir data de hoje como padrÃ£o
        document.getElementById('date').valueAsDate = new Date();

        function editExpense(id, description, amount, category, date) {
            document.getElementById('editModal').style.display = 'block';
            document.getElementById('editForm').action = '/expenses/edit/' + id;
            document.getElementById('edit_description').value = description;
            document.getElementById('edit_amount').value = amount;
            document.getElementById('edit_category').value = category;
            document.getElementById('edit_date').value = date;
        }

        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            var modal = document.getElementById('editModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>